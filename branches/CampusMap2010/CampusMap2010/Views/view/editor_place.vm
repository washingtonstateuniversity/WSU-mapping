#if($Flash.error)
<p style="color: red; font-weight: bold;">
    $Flash.error
</p>
#end
#if($view.id)
	<a href="$siteroot/Pdf/new.castle" class="PDF creation buttons ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only">
		<span class="ui-icon ui-icon-plusthick inlineIcon"></span>Create a Print Version
	</a>
	#if($view.id!=0)<a href="$siteroot/read/${view.CustomUrl}" style="height:33px" target="_blank" title="View" class="PDF creation buttons ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only">
		<span class="ui-icon ui-icon-search"  style="margin-top: 3px;"> </span>
	</a>#end
#end

<div id="tabs" class="ui-tabs ui-widget ui-widget-content ui-corner-all view_new">
  <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
    <li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active">
      <a href="#tabs-1">Basic</a>
    </li>
    <li class="ui-state-default ui-corner-top">
      <a href="#tabs-2">Text</a>
    </li>
    <li class="ui-state-default ui-corner-top">
      <a href="#tabs-3">Detail</a>
    </li>
    <li class="ui-state-default ui-corner-top">
      <a href="#tabs-4">Images</a>
    </li>
    #if($comments.TotalItems&&$comments.TotalItems!=0)<li class="ui-state-default ui-corner-top">
      <a href="#tabs-5">Comments</a>
    </li>#end
  </ul>
  
<form action="update.castle" method="post">
  
  
  <div id="tabs-1">
  
  
<p class="validateTips">All form fields are required.</p>
        <form>$Form.HiddenField("view.id")
            <fieldset><legend>Location</legend>
                <label for="LocationTypeSelect">Location Type</label><br/>
                <select id="LocationTypeSelect">
                    <option value="">Select one...</option>
                    <option value="Parking">Parking</option>
                    <option value="Stadium">Stadium</option>
                    <option value="Building">Building</option>
                    <option value="Landmark">Landmark</option>
                </select><br/>
                
                <label for="Lat">Latitude</label><br/>
                <input type="text" name="Lat" id="Lat" value="" class="text ui-widget-content ui-corner-all" /><br/>
                <label for="Long">Longitude</label><br/>
                <input type="text" name="Long" id="Long" value="" class="text ui-widget-content ui-corner-all" /><br/>
                
                
            </fieldset>
            <fieldset><legend>Naming</legend>
                <label for="name">Preferred Map Name</label><br/>
                <input type="text" name="name" id="name" value="" class="text ui-widget-content ui-corner-all"  size="50"/><br/>
                
                
                <label for="Official">Official Name</label><br/>
                <input type="text" name="Official" id="Official" value="" class="text ui-widget-content ui-corner-all"  size="50"/><br/>
                
                <label for="Alternate">Alternate Name</label><br/>
                <input type="text" name="Alternate" id="Alternate" value="" class="text ui-widget-content ui-corner-all"  size="50"/><br/>     
                <label for="Abbrev">Bldg Abbrev</label><br/>
                <input type="text" name="Abbrev" id="Abbrev" value="" class="text ui-widget-content ui-corner-all" /><br/>               
            </fieldset>
            
            <fieldset>
            	<label for="tags">Tag location: </label><br/>
				<input id="tags"  class="text ui-widget-content ui-corner-all" size="50" /><br/>
            </fieldset>  
            
        </form>


    #if($Controller.canPublish($loginUser)) <p class="wsu_ui">
      Publication Date:  <br/>
      <input type="text" value="$!view.publishtime" name="view.publishtime" id="view_publishtime" class="ui-widget ui-widget-content ui-corner-all w150" />
    </p>
    <p>
      View Status:<br/>
      $Form.Select("view.status.id", $statuslists, "%{value='id', text='Title'}")
    </p>
    #else
    <input type="hidden" value="1" name="view.status.id" />
    #end
    #*<p>
      Show in breaking News: <br/> $FormHelper.CheckboxField("view.BreakingNews")
    </p>
    <p>
      Show in featured News: <br/> $FormHelper.CheckboxField("view.FeaturedNews")
    </p>*#

    #set($count = 0)
    #set($id = 0)
    #*<div id="tagArea">
      <h3>Tags</h3>
      <h4 style="display:inline-block;">Existing tags</h4>
      <h5>Select or create new tag (if one isn't already created)</h5>
      <h6>Type a new tag name if not in the list.</h6>

      <ul style="list-style:none;">
        #foreach($viewtag in $viewtags)
        <li>
          <select name="tags[$!count].id" id="tag_$viewtag.id">
            <option class="" value="">-select-</option>
            #foreach($tag in $tags)
            <option class="tag" value="$tag.id" #if($viewtag == $tag) selected="selected" #end>$!tag.Name</option>
            #set($id = $viewtag.id)
            #end
          </select>

          #if($viewtag.id!=0)
          <a rel="$viewtag.id" title="$view.id" style="cursor:pointer;display: inline-block;" class="DeleteTag ui-state-error ui-corner-all">
            <span class="ui-icon ui-icon-trash"></span>
          </a>
          #else
          <input type="text" class="tag ui-widget ui-widget-content ui-corner-all " name="newtag" value="" style="cursor:pointer;display: inline-block;" />
          #end
        </li>
        #set($count = $count + 1)
        #end
      </ul>

    </div>

    <div id="NewTagHolderDiv"></div>

    <a style="cursor:pointer;" onclick="AddTag()">+ add additional tags</a>
    *#
    <div class="clear"></div>
  </div>
  <div id="tabs-2">

      <h3>Teaser :</h3>
      #*$Form.TextArea("view.Teaser")*#
      <textarea id="view_Teaser" name="view.Teaser"  class="tinyEditor">$!view.Teaser</textarea>  

      <h3>Body Text :</h3>
      #*$Form.TextArea("view.Bodytext")*#
      <textarea id="view_Bodytext" name="view.Bodytext"  class="tinyEditor">$!view.Bodytext</textarea>

    <div class="clear"></div>
  </div>
  
  
  <div id="tabs-3">

    <h3>View Type :</h3>
    $Form.Select("view.viewType.id", $viewtype, "%{value='id', text='Name', firstoption='-select-',firstoptionvalue=''}") 	  	 <br/><br/>

    <div id="AuthorDiv">
      <h3>Authors</h3>
      <h4>Select or create new author (if one isn't already created)</h4>
      #set($count = 0)
      #set($id = 0)
      #foreach($viewauthor in $viewauthors)
      <div id="div$viewauthor.id">
        <select name="Authors[$!count].id" id="author$viewauthor" class="authorSelect">
          <option class="" value="">-select-</option>
          #foreach($author in $authors)
          <option class="author" value="$author.id" #if($viewauthor == $author) selected="selected" #end>$!author.Name</option>
          #set($id = $viewauthor.id)
          #end
        </select>

        #if($id!=0)
        <a title="$id" rel="$view.id"  style="cursor:pointer;display: inline-block;" class="deleteAuthor ui-state-error ui-corner-all">
          <span class="ui-icon ui-icon-trash"></span>
        </a>
        #end
        <div class="lightLine"></div>
      </div>
      #set($count = $count + 1)
      #end

      #*<select name="authors[$!count].id" id="author">
        <option class="" value="">-select-</option>
        #foreach($author in $authors)
        <option class="author" value="$author.id" #if($viewauthor == $author) selected="selected" #end>$!author.Name</option>
        #end
      </select>*#


      <div class="lightLine"></div>
      <input type="hidden" id="NextAuthorID" name="NextAuthorID" value="$my_var"/>

      <div id="NewAuthorHolderDiv"></div>
    </div>

    <a style="cursor:pointer;" onclick="AddAuthor()">+ add additional authors</a>
    <div class="clear"></div>
  <br/>
    
  </div>
  
    <div id="tabs-4">

    
        <div id="ImageDiv">
            <h3>View Images</h3>
        
            <a href="#" class="insotryupload buttons">Upload Images</a>
            <br/><br/>
           <span id="img_layout_choice" class="grid"></span>
            <div id="browserBox" class="ui-corner-all grid">
                #foreach($viewimage in $viewimages)
                    #if($viewimage.id!=0)
                    <input type="hidden" name="images[$!{viewimage.id}].id" value="$!{viewimage.id}" />
                        <span class="imageBox">
                            <img src="/media/download.castle?id=${viewimage.id}&viewid=${view.id}&m=crop&w=175&h=175&pre=borwser" class="previewImg" width="175" height="175"/>
                            <a title="$viewimage.id" rel="$view.id" style="cursor:pointer;display: inline-block;" class="DeleteImage ui-state-error ui-corner-all">
                                <span class="ui-icon ui-icon-trash"></span>
                            </a>
                            <span class="imgInfo">
                              <span><label>Caption:</label><input type="text" value="$!{viewimage.caption}" name="images[$!{viewimage.id}].Caption" class=""/></span>
                              <span><label>Credit:</label><input type="text" value="$!{viewimage.credit}" name="images[$!{viewimage.id}].Credit" class="viewCredit"/></span>
                              <span><label>Order:</label>
                              <input type="hidden" value="$!{viewimage.ViewImages.get_Item(0).id}" name="ViewImages[$!{viewimage.id}].id" class=""/>
                              <input type="text" value="$!{viewimage.ViewImages.get_Item(0).viewOrder}" name="ViewImages[$!{viewimage.id}].viewOrder" class="viewOrder"/>
                              <input type="hidden" value="$!{viewimage.id}" name="ViewImages[$!{viewimage.id}].Image.id" class="viewOrderId"/>
                              </span>
                            </span>
                        </span>
                    #end
                #end
                <div class="clearings" style="clear:both;"></div>
            </div>
    <div class="clear"></div>
        </div>
    </div>
</form>
  #if($comments.TotalItems&&$comments.TotalItems!=0)
  <div id="tabs-5">

    <h3>Comment List</h3>

    <table width="100%" border="0" style="float:right;margin-right:5px;margin-top:7px;">
      <tr>
        <td>Showing $comments.FirstItem - $comments.LastItem of $comments.TotalItems</td>
        <td align="right">
          #if($comments.HasPrevious) $PaginationHelper.CreatePageLink( 1, "first" )
          | $PaginationHelper.CreatePageLink( $comments.PreviousIndex, "prev" ) #end
          #if($comments.HasNext) | $PaginationHelper.CreatePageLink( $comments.NextIndex, "next" )
          | $PaginationHelper.CreatePageLink( $comments.LastIndex, "last" ) #end
        </td>
      </tr>
    </table>
    <table  width="100%" class="ui-widget ui-widget-content">
      <thead>
        <tr class="ui-widget-header ">
          <th>View</th>
          <th>Comments</th>
          <th>Flagged</th>
          <th>Published</th>
          <th>&nbsp;</th>
        </tr>
      </thead>
      <tbody>

        #set ($c=0)
        #foreach($comment in $comments)
        <tr class="#if($c%2>0) even #else odd #end #if($comment.adminRead==false) ui-state-highlight #end ">
          <td>$!comment.View.id</td>
          <td>$Text.Fold($Controller.StripHtml($!comment.Comments,false),100)</td>
          <td #if($comment.Flagged==true) class="ui-state-error" #end>$!comment.Flagged</td>
          <td>$!comment.published</td>
          <td class='actionArea'>

            <span style='font-size:0.7em;'>
              <a href="../comment/edit.castle?id=$!{comment.id}" title="Edit" class="buttons ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only">
                <span class="ui-icon ui-icon-pencil"></span>
              </a>
              <a href="../comment/delete.castle?id=$!{comment.id}" title="Delete" class="buttons ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only">
                <span class="ui-icon ui-icon-trash"></span>
              </a>
            </span>
          </td>
        </tr>
        #set ($c=$c+1)
        #end
      </tbody>
    </table>
    <table width="100%" border="0" >
      <tr>
        <td>Showing $comments.FirstItem - $comments.LastItem of $comments.TotalItems</td>
        <td align="right">
          #if($comments.HasPrevious) $PaginationHelper.CreatePageLink( 1, "first" )
          | $PaginationHelper.CreatePageLink( $comments.PreviousIndex, "prev" ) #end
          #if($comments.HasNext) | $PaginationHelper.CreatePageLink( $comments.NextIndex, "next" )
          | $PaginationHelper.CreatePageLink( $comments.LastIndex, "last" ) #end
        </td>
      </tr>
    </table>
  </div>
  #end


</div>
